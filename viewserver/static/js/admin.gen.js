(function(){var admin;admin={i18n:{401:"401 — Yoba Wants To Know Your Name",403:"403 — Not On This Page, Buddy",404:"404 — The Page You're Looking At Is Outdated"},enable:function(uid){$.cookie("userid",uid,{path:"/"});return $.ajax("/_ismod/",{dataType:"json",statusCode:{403:function(){return $.removeCookie("userid",{path:"/"})},200:function(data){if(data===true||data.indexOf(location.pathname.split("/")[1])>=0){return $("body").addClass("admin")}}}})},request:function(id,path,opts){return $.ajax("/"+id+path,{data:opts.data,method:opts.method,statusCode:{200:function(){if(opts.mandad!=null){return opts.mandad()}else{return location.reload()}},403:function(){return dialog.alert(dialog.h3(admin.i18n[403]))},404:function(){return dialog.alert(dialog.h3(admin.i18n[404]))}}})},board:{prompt:function(category){var form,head;head=$("#admin-new-board-head").clone();form=$("#admin-new-board-form").clone();form.find("#admin-new-board-cat").val(category);return bootbox.dialog({title:head,message:form,buttons:{OK:{className:"btn-primary",callback:function(){var cat,id,title;id=form.find("#admin-new-board-id").val();title=form.find("#admin-new-board-title").val();cat=form.find("#admin-new-board-cat").val();if(id&&title&&cat){return admin.board.add(id,title,cat)}}}}})},del:function(id){return admin.request(id,"/",{method:"DELETE"})},add:function(id,title,category){return admin.request(id,"/",{method:"PUT",data:{title:title,cat:category}})}},tree:{idof:function(node){return $(node).parents(".post").attr("data-id")},open:function(id){return admin.tree.bool(id,"close",false)},close:function(id){return admin.tree.bool(id,"close",true)},attach:function(id){return admin.tree.bool(id,"attach",true)},detach:function(id){return admin.tree.bool(id,"attach",false)},del:function(id){return admin.request(id,"/",{method:"DELETE"})},bool:function(id,prop,value){return admin.request(id,"/"+prop,{method:value?"PUT":"DELETE",mandad:function(){return $("#"+id.split("/")[1]).toggleClass("prop-"+prop)}})}}};$(function(){$(document).on("click",".adm-attach",function(){return admin.tree.attach(admin.tree.idof(this))}).on("click",".adm-detach",function(){return admin.tree.detach(admin.tree.idof(this))}).on("click",".adm-close",function(){return admin.tree.close(admin.tree.idof(this))}).on("click",".adm-open",function(){return admin.tree.open(admin.tree.idof(this))}).on("click",".adm-rmtree",function(){return admin.tree.del(admin.tree.idof(this))}).on("click",".adm-crboard",function(){return admin.board.prompt($(this).attr("data-cat"))}).on("click",".adm-rmboard",function(){return admin.board.del($(this).attr("data-id"))}).on("click","#admin-mode",function(){if($("body").hasClass("admin")){$("body").removeClass("admin");return $.removeCookie("userid",{path:"/"})}else{return bootbox.prompt(admin.i18n[401],function(val){if(val!==null){return admin.enable(val)}})}});if($.cookie("userid")!==null){return admin.enable($.cookie("userid"))}})}).call(this);