(function(){window.admin={i18n:{401:"401 — Yoba Wants To Know Your Name",403:"403 — Not On This Page, Buddy",404:"404 — The Page You're Looking At Is Outdated"},enable:function(uid){dialog.loading($(document.body));$.cookie("userid",uid,{path:"/"});return $.ajax("/_ismod/",{dataType:"json",success:function(){return dialog.unloading($(document.body))},error:function(){return dialog.unloading($(document.body))},statusCode:{403:function(){return $.removeCookie("userid",{path:"/"})},200:function(data){if(data===true||data.indexOf(location.pathname.split("/")[1])>=0){return $("body").addClass("admin")}}}})},request:function(id,lock,path,opts){dialog.loading(lock);return $.ajax("/"+id+path,{data:opts.data,method:opts.method,success:function(){return dialog.unloading(lock)},error:function(){return dialog.unloading(lock)},statusCode:{200:function(){if(opts.mandad!=null){return opts.mandad()}else{return location.reload()}},403:function(){return dialog.alert(dialog.h3(admin.i18n[403]))},404:function(){return dialog.alert(dialog.h3(admin.i18n[404]))}}})},board:{prompt:function(category){var form,head;head=$("#admin-new-board-head").clone();form=$("#admin-new-board-form").clone();form.find("#admin-new-board-cat").val(category);return bootbox.dialog({title:head,message:form,buttons:{OK:{className:"btn-primary",callback:function(){var cat,id,title;id=form.find("#admin-new-board-id").val();title=form.find("#admin-new-board-title").val();cat=form.find("#admin-new-board-cat").val();if(id&&title&&cat){return admin.board.add(id,title,cat)}}}}})},del:function(id){return admin.request(id,$("body"),"/",{method:"DELETE"})},add:function(id,title,category){return admin.request(id,$("body"),"/",{method:"PUT",data:{title:title,cat:category}})}},tree:{open:function(post){return admin.tree.bool(post,"close",false)},close:function(post){return admin.tree.bool(post,"close",true)},attach:function(post){return admin.tree.bool(post,"attach",true)},detach:function(post){return admin.tree.bool(post,"attach",false)},del:function(post){return admin.request(post.attr("data-id"),$("body"),"/",{method:"DELETE"})},bool:function(post,prop,value){return admin.request(post.attr("data-id"),post,"/"+prop,{method:value?"PUT":"DELETE",mandad:function(){return post.toggleClass("prop-"+prop)}})}}};$(function(){$(document).on("click",".adm-attach",function(){return admin.tree.attach($(this).parents(".post"))}).on("click",".adm-detach",function(){return admin.tree.detach($(this).parents(".post"))}).on("click",".adm-close",function(){return admin.tree.close($(this).parents(".post"))}).on("click",".adm-open",function(){return admin.tree.open($(this).parents(".post"))}).on("click",".adm-rmtree",function(){return admin.tree.del($(this).parents(".post"))}).on("click",".adm-crboard",function(){return admin.board.prompt($(this).attr("data-cat"))}).on("click",".adm-rmboard",function(){return admin.board.del($(this).attr("data-id"))}).on("click","#admin-mode",function(){if($("body").hasClass("admin")){$("body").removeClass("admin");return $.removeCookie("userid",{path:"/"})}else{return bootbox.prompt(admin.i18n[401],function(val){if(val!==null){return admin.enable(val)}})}});if($.cookie("userid")){return admin.enable($.cookie("userid"))}})}).call(this);