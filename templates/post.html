{% macro post(p, list_mode) %}
<div class="post media {% if p.parent == 0 %}post-original{% else %}post-reply{% endif %}" id="{{ p.id }}">
  <div class="post-header media-heading">
    <a href="{{ url_for('html.thread_redirect', board=board, thread=p.thread) }}#{{ p.id }}" class="post-id">#{{ p.id }}</a>
    {% if p.title %}
      <span class="post-title">{{ p.title }}</span>
    {% endif %}
    <span class="post-timestamp">{{ p.timestamp.strftime('%d.%m.%Y %H:%M:%S') }}</span>
    {% if p.sage %}
      <span class="post-sage"></span>
    {% endif %}
    <a class="glyphicon glyphicon-edit post-reply-btn" title="Ответить" data-toggle="collapse" data-target="#post-form-{{ p.id }}"></a>
    <a class="glyphicon glyphicon-collapse-down post-expand-btn" title="Развернуть"></a>
    <a class="glyphicon glyphicon-collapse-up post-collapse-btn" title="Свернуть"></a>
  </div>

  <div class="post-content clearfix">
    {% for file in p.files %}
      <div class="post-attach pull-left">
        <a href="/static/upload/{{ file[0] }}">
          {% if file[1] %}
            <img class="media-object" src="/static/upload/{{ file[1] }}" />
          {% else %}
            <span class="media-object" data-media-mime="{{ file[2] }}"></span>
          {% endif %}
        </a>
      </div>
    {% endfor %}

    <div class="post-body media-body">
      {% if list_mode and p.parent and p.parent != p.thread %}
        <a class="post-parent post-anchor" href="{{ url_for('html.thread_redirect', board=board, thread=p.thread) }}#{{ p.parent }}" data-id="{{ p.parent }}" data-board="{{ board }}">{{ p.parent }}</a><br />
      {% endif %}

      {{ p.text|safe }}
    </div>
  </div>

  <div class="collapse post-form" id="post-form-{{ p.id }}">
    {{ post_form(url_for('html.thread_redirect', board=board, thread=p.thread), p.id) }}
  </div>
</div>
{% endmacro %}

{% macro post_form(url, parent) %}
<form method="post" role="form" enctype="multipart/form-data" action="{{ url }}">
  <input type="hidden" name="parent" value="{{ parent }}" />

  <div class="input-group">
    <input type="text" class="form-control" name="title" placeholder="Тема"></td>
    <label class="input-group-addon" type="checkbox">
      <input type="checkbox" name="sage" />
      Сажа
    </label>
  </div>

  <div class="input-group">
    <textarea class="form-control" name="text" rows="5" cols="40" placeholder="Ценное сообщение"></textarea>
  </div>

  <div class="input-group">
    <div class="input-group-addon adjacent-file-control btn btn-default">
      <span class="glyphicon glyphicon-search"></span>
    </div>
    <input type="file" name="file" class="hidden" />
    <input type="text" class="form-control adjacent-file-control adjacent-file-display" disabled />
  </div>

  <div class="input-group">
    <button type="submit" class="btn btn-default">{% if parent %}Ответить{% else %}Создать тред{% endif %}</button>
  </div>
</form>
{% endmacro %}
